From c69967239b91104e8e53b1a1bf930ff8303c4af0 Mon Sep 17 00:00:00 2001
From: Hao Yao <hao.yao@intel.com>
Date: Mon, 26 Jan 2026 18:10:20 +0800
Subject: [PATCH 7/7] staging: ipu7: Define gpreg_stride for different IPU
 versions

Signed-off-by: Hao Yao <hao.yao@intel.com>
---
 drivers/staging/media/ipu7/ipu7-isys-csi-phy.c | 6 ++++--
 drivers/staging/media/ipu7/ipu7.c              | 3 +++
 drivers/staging/media/ipu7/ipu7.h              | 1 +
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/media/ipu7/ipu7-isys-csi-phy.c b/drivers/staging/media/ipu7/ipu7-isys-csi-phy.c
index b8c5db7ae300..bd83aef7067e 100644
--- a/drivers/staging/media/ipu7/ipu7-isys-csi-phy.c
+++ b/drivers/staging/media/ipu7/ipu7-isys-csi-phy.c
@@ -167,7 +167,8 @@ static void gpreg_write(struct ipu7_isys *isys, u32 id, u32 addr, u32 data)
 {
 	void __iomem *isys_base = isys->pdata->base;
 	u32 gpreg = isys->pdata->ipdata->csi2.gpreg;
-	void __iomem *base = isys_base + gpreg + 0x1000 * id;
+	void __iomem *base = isys_base + gpreg +
+			     isys->pdata->ipdata->csi2.gpreg_stride * id;
 	struct device *dev = &isys->adev->auxdev.dev;

 	dev_dbg(dev, "gpreg write: reg 0x%zx = data 0x%08x",
@@ -344,7 +345,8 @@ static int ipu7_isys_phy_ready(struct ipu7_isys *isys, u32 id)
 {
 	void __iomem *isys_base = isys->pdata->base;
 	u32 gpreg_offset = isys->pdata->ipdata->csi2.gpreg;
-	void __iomem *gpreg = isys_base + gpreg_offset + 0x1000 * id;
+	void __iomem *gpreg = isys_base + gpreg_offset +
+			      isys->pdata->ipdata->csi2.gpreg_stride * id;
 	struct device *dev = &isys->adev->auxdev.dev;
 	unsigned int i;
 	u32 phy_ready;
diff --git a/drivers/staging/media/ipu7/ipu7.c b/drivers/staging/media/ipu7/ipu7.c
index 630a87b83b4b..db7e452cff04 100644
--- a/drivers/staging/media/ipu7/ipu7.c
+++ b/drivers/staging/media/ipu7/ipu7.c
@@ -52,6 +52,7 @@ static const unsigned int ipu7_csi_offsets[] = {
 static struct ipu_isys_internal_pdata ipu7p5_isys_ipdata = {
 	.csi2 = {
 		.gpreg = IS_IO_CSI2_GPREGS_BASE,
+		.gpreg_stride = 0x1000,
 	},
 	.hw_variant = {
 		.offset = IPU_UNIFIED_OFFSET,
@@ -792,6 +793,7 @@ static struct ipu_psys_internal_pdata ipu7p5_psys_ipdata = {
 static struct ipu_isys_internal_pdata ipu7_isys_ipdata = {
 	.csi2 = {
 		.gpreg = IS_IO_CSI2_GPREGS_BASE,
+		.gpreg_stride = 0x1000,
 	},
 	.hw_variant = {
 		.offset = IPU_UNIFIED_OFFSET,
@@ -1309,6 +1311,7 @@ static struct ipu_psys_internal_pdata ipu7_psys_ipdata = {
 static struct ipu_isys_internal_pdata ipu8_isys_ipdata = {
 	.csi2 = {
 		.gpreg = IPU8_IS_IO_CSI2_GPREGS_BASE,
+		.gpreg_stride = 0x2000,
 	},
 	.hw_variant = {
 		.offset = IPU_UNIFIED_OFFSET,
diff --git a/drivers/staging/media/ipu7/ipu7.h b/drivers/staging/media/ipu7/ipu7.h
index 3b3ea5fb613f..95ccec4de424 100644
--- a/drivers/staging/media/ipu7/ipu7.h
+++ b/drivers/staging/media/ipu7/ipu7.h
@@ -204,6 +204,7 @@ struct ipu7_isys_internal_csi2_pdata {
 	u32 nports;
 	u32 const *offsets;
 	u32 gpreg;
+	u32 gpreg_stride;
 };

 struct ipu7_hw_variants {
--
2.43.0

